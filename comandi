minikube start --cpus 4 --memory 4096
eval $(minikube docker-env)
minikube addons enable ingress

kubectl apply -f autoscalers/custom-hpa.yaml

helm delete my-release
helm delete kube-state-metrics

helm install my-release -f myvalues.yaml prometheus-community/prometheus-adapter
helm install kube-state-metrics prometheus-community/kube-state-metrics


curl airline-management-system.app.loc/user-service/users/getAllUsers |jq
curl airline-management-system.app.loc/flight-service/flights/getAllFlights |jq
curl airline-management-system.app.loc/flight-reservation-service/flight_reservations/getAllFlightReservations |jq

curl airline-management-system.app.loc/flight-service/airports/getAllAirports |jq
curl airline-management-system.app.loc/flight-reservation-service/flight_fares/getAllFlightFares |jq
curl airline-management-system.app.loc/flight-reservation-service/luggage/getAllLuggage |jq

curl airline-management-system.app.loc/user-service/users/deleteAllUsers -X DELETE
curl airline-management-system.app.loc/flight-service/flights/deleteAllFlights -X DELETE
curl airline-management-system.app.loc/flight-reservation-service/flight_reservations/deleteAllFlightReservations -X DELETE

curl airline-management-system.app.loc/flight-service/airports/deleteAllAirports -X DELETE
curl airline-management-system.app.loc/flight-reservation-service/flight_fares/deleteAllFlightFares -X DELETE
curl airline-management-system.app.loc/flight-reservation-service/luggage/deleteAllLuggage -X DELETE

python insert_users.py 10
python insert_flights.py 1 # andata e ritorno -> 2
python insert_flight_reservations.py 10

python insert_users.py 100
python insert_flights.py 5
python insert_flight_reservations.py 100

python insert_users.py 1000
python insert_flights.py 50
python insert_flight_reservations.py 1000

kubectl delete deployments --all && kubectl delete services --all && kubectl delete pods --all && kubectl delete ingress --all && kubectl delete replicaset --all
kubectl delete hpa user-service-hpa && kubectl delete hpa flight-service-hpa && kubectl delete hpa flight-reservation-service-hpa
kubectl delete hpa user-service-custom-hpa && kubectl delete hpa flight-service-custom-hpa && kubectl delete hpa flight-reservation-service-custom-hpa

locust -f load_generator.py --host=http://airline-management-system.app.loc/ --autostart --autoquit=0

kubectl scale --replicas=1 deployment/user-service
kubectl scale --replicas=1 deployment/flight-service
kubectl scale --replicas=1 deployment/flight-reservation-service

-----

kubectl delete hpa flight-reservation-service-custom-hpa
kubectl scale --replicas=0 deployment/flight-reservation-service
kubectl delete deployment.apps/flight-reservation-service 
kubectl apply -f k8s/
curl airline-management-system.app.loc/flight-reservation-service/flight_reservations/getAllFlightReservations |jq
kubectl apply -f autoscalers/custom-hpa.yaml
